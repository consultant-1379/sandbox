{"paragraphs":[{"title":"Batch correlation tutorial","text":"This tutorial steps you through creating avro schema, installing schemas, running application to achieve the batch correlation. Please login into the sandbox and follow the instruction in this note.\n\nIt is originated from the how-to series provided by Liam Fallon. Please check the AIA development blog http://analytics.ericsson.se:23307/2016/11/22/streaming-and-batch-correlation-how-to-guide/ for reference. ","dateUpdated":"2016-11-24T17:29:55-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539887_134997573","id":"20161124-113637_1262068968","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3875"},{"title":"Log in sandbox","text":"ssh -i <keypair file> cloud-user@<sandbox IP address>","dateUpdated":"2016-11-24T17:28:59-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539889_145001045","id":"20161124-114137_1121847309","result":{"code":"ERROR","type":"TEXT","msg":""},"dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3876"},{"title":"Prepartion","text":"Check directory /home/cloud-user/example for the aia-support folder, please clone the project with your signum if it doesn't exist,\n\n    git clone ssh://<signum>@gerrit.ericsson.se:29418/com.ericsson.nmlab/aia-support\n\nNOTE: you need permission to access the git repo and also need to configure the public key in gerrit.\n\nCheck directory /home/cloud-user/example for the model folder, please clone the project with your signum and change to branch dVersionAttribute_with_pojo if the folder doesn't exist,\n\n    git clone ssh://<signum>@gerrit.ericsson.se:29418/AIA/model\n    cd model\n    git checkout dVersionAttribute_with_pojo\n    \n","dateUpdated":"2016-11-24T17:28:59-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539889_145001045","id":"20161124-114546_1061135656","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3877"},{"title":"Project Build","text":"Build the model project first,\n\n    cd /home/cloud-user/example/model\n    mvn clean install\n    \nBuild the aia-support project,\n\nChange the kafka-clients dependency version from 0.10.0.x to 0.9.0.0 in the following pom files\n\n    /home/cloud-user/example/aia-support/aia-support.datasink/pom.xml\n    /home/cloud-user/example/aia-support/aia-support.csv-datasource/pom.xml\n\nRun the following command to build the whole project. -DinstallSchemas is used to install the generated avro schema to schema registry.\n\n    cd /home/cloud-user/example/aia-support\n    mvn clean install -DinstallSchemas","dateUpdated":"2016-11-24T17:28:59-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539890_146155291","id":"20161124-125440_1990368102","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3878"},{"title":"AVRO schema","text":"Run the following command to make sure all the schemas are installed successfully\n\ncurl http://localhost:8081/subjects/correlation.SALES_EVENT/versions/latest\ncurl http://localhost:8081/subjects/correlation.SALES_INPUT/versions/latest\ncurl http://localhost:8081/subjects/correlation.BRANCH_INPUT/versions/latest\ncurl http://localhost:8081/subjects/correlation.ITEMS_INPUT/versions/latest\ncurl http://localhost:8081/subjects/correlation.ASSISTANT_INPUT/versions/latest","dateUpdated":"2016-11-24T17:28:59-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539890_146155291","id":"20161124-121014_776872561","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3879"},{"title":"Run the data sink","text":"Run the following command to subscribe to correlation output\n\n    cd /home/cloud-user/example/aia-support\n    bin/runEventSink.sh localhost:9092 http://localhost:8081 SALES_OUTPUT","dateUpdated":"2016-11-24T17:31:02-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539890_146155291","id":"20161124-124450_971612336","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3880"},{"title":"Run the correlation","text":"Open a new connection to sandbox. \n\nMake sure the flow xml(/home/cloud-user/example/aia-support/aia-support.sample-batch-correlation/src/main/resources/BatchFlow.xml) is pointing at the right CSV source files. If not change to point to /home/cloud-user/example/aia-support/aia-support.csv-datasource/src/main/resources/SampleData/ folder.\n\nReplace the <IP Address> with sandbox IP address in the following command and run it\n\n    export SPARK_HOME=/usr/lib/spark/\n    cd /home/cloud-user/example/aia-support\n    bin/runCorrelation.sh http://localhost:8081 spark://<IP Address>:7077 aia-support.sample-batch-correlation\n    \n","dateUpdated":"2016-11-24T17:34:37-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539890_146155291","id":"20161124-123158_1305004017","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3881"},{"title":"Expected Result","text":"In data sink console, expect the following output,\n\nRecord no:0, AIA event id=0, value= {\"_NE\": \"\", \"_TIMESTAMP\": 0, \"_ID\": 0, \"_VERSION\": \"\", \"SALES_TRANSACTION_SALE_ID\": 32194818, \"SALES_TRANSACTION_AMOUNT\": 5.7, \"SALES_TRANSACTION_ITEM_ID\": 1277689, \"SALES_TRANSACTION_QUANTITY\": 89, \"SALES_TRANSACTION_ASSISTANT_ID\": 33, \"SALES_TRANSACTION_BRANCH_NAME\": \"Athlone\", \"SALES_TRANSACTION_NOTES\": \"\", \"ITEM_DETAILS_ITEM_ID\": 1277689, \"ITEM_DETAILS_DESCRIPTION\": \"Crested Ten\", \"ITEM_DETAILS_COST_PRICE\": 15.23, \"ITEM_DETAILS_BARCODE\": 45543345, \"ITEM_DETAILS_SUPPLIER_ID\": 134435, \"ITEM_DETAILS_CATEGORY\": \"Alcahol\", \"ASSISTANT_DETAILS_ASSISTANT_ID\": 33, \"ASSISTANT_DETAILS_SURNAME\": \"Yamada\", \"ASSISTANT_DETAILS_FIRSTNAME\": \"Taro\", \"ASSISTANT_DETAILS_MIDDLENAME\": \"Nanno\", \"ASSISTANT_DETAILS_AGE\": 34, \"ASSISTANT_DETAILS_GRADE\": 3, \"ASSISTANT_DETAILS_PHONE_NO\": 892344333, \"BRANCH_DETAILS_BRANCH_NAME\": \"Athlone\", \"BRANCH_DETAILS_BRANCH_ID\": 99556, \"BRANCH_DETAILS_BRANCH_CATEGORY\": \"Sub\", \"BRANCH_DETAILS_STREET\": \"Church Street\", \"BRANCH_DETAILS_CITY\": \"Athlone\", \"BRANCH_DETAILS_COUNTRY\": \"Ireland\", \"BRANCH_DETAILS_POSTCODE\": \"N37 E733\"}\nRecord no:1, AIA event id=0, value= {\"_NE\": \"\", \"_TIMESTAMP\": 0, \"_ID\": 0, \"_VERSION\": \"\", \"SALES_TRANSACTION_SALE_ID\": 45455562, \"SALES_TRANSACTION_AMOUNT\": 75755.8, \"SALES_TRANSACTION_ITEM_ID\": 1277689, \"SALES_TRANSACTION_QUANTITY\": 2313, \"SALES_TRANSACTION_ASSISTANT_ID\": 33, \"SALES_TRANSACTION_BRANCH_NAME\": \"Athlone\", \"SALES_TRANSACTION_NOTES\": \"\", \"ITEM_DETAILS_ITEM_ID\": 1277689, \"ITEM_DETAILS_DESCRIPTION\": \"Crested Ten\", \"ITEM_DETAILS_COST_PRICE\": 15.23, \"ITEM_DETAILS_BARCODE\": 45543345, \"ITEM_DETAILS_SUPPLIER_ID\": 134435, \"ITEM_DETAILS_CATEGORY\": \"Alcahol\", \"ASSISTANT_DETAILS_ASSISTANT_ID\": 33, \"ASSISTANT_DETAILS_SURNAME\": \"Yamada\", \"ASSISTANT_DETAILS_FIRSTNAME\": \"Taro\", \"ASSISTANT_DETAILS_MIDDLENAME\": \"Nanno\", \"ASSISTANT_DETAILS_AGE\": 34, \"ASSISTANT_DETAILS_GRADE\": 3, \"ASSISTANT_DETAILS_PHONE_NO\": 892344333, \"BRANCH_DETAILS_BRANCH_NAME\": \"Athlone\", \"BRANCH_DETAILS_BRANCH_ID\": 99556, \"BRANCH_DETAILS_BRANCH_CATEGORY\": \"Sub\", \"BRANCH_DETAILS_STREET\": \"Church Street\", \"BRANCH_DETAILS_CITY\": \"Athlone\", \"BRANCH_DETAILS_COUNTRY\": \"Ireland\", \"BRANCH_DETAILS_POSTCODE\": \"N37 E733\"}\n","dateUpdated":"2016-11-24T17:37:37-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","title":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539890_146155291","id":"20161124-171642_786229934","dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3882"},{"text":"","dateUpdated":"2016-11-24T17:28:59-0500","config":{"colWidth":12,"editorMode":"ace/mode/scala","graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1480026539890_146155291","id":"20161124-171637_1324067024","result":{"code":"ERROR","type":"TEXT","msg":""},"dateCreated":"2016-11-24T17:28:59-0500","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:3883"}],"name":"BPS based batch correlation","id":"2C2CEC1CG","angularObjects":{"2C28SRPHR:shared_process":[],"2BZVK82HU:shared_process":[],"2C2WWHDX5:shared_process":[],"2C1AB9NGZ:shared_process":[],"2BZYXDBWV:shared_process":[],"2C33K6QH8:shared_process":[],"2C37AUD79:shared_process":[],"2C2CUPZCP:shared_process":[],"2C14WP1EG:shared_process":[],"2BZF1VUDC:shared_process":[],"2C37NMVGZ:shared_process":[],"2C2UZNMPK:shared_process":[],"2C33HXU75:shared_process":[],"2C41CQSTT:shared_process":[],"2C3HVUNT4:shared_process":[],"2C1T3P5DN:shared_process":[],"2BZVJCNJU:shared_process":[],"2C1AP3V9G:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}